<% if node[:deploy][@application_name][:ssl_support] -%>
  <VirtualHost *:443>
    ServerName <%= @params[:server_name] %>

    SSLEngine on
    SSLProxyEngine on
    SSLCertificateFile <%= node[:apache][:dir] %>/ssl/<%= @params[:server_name] %>.crt
    SSLCertificateKeyFile <%= node[:apache][:dir] %>/ssl/<%= @params[:server_name] %>.key
    <% if @params[:ssl_certificate_ca] -%>
      SSLCACertificateFile <%= node[:apache][:dir] %>/ssl/<%= @params[:server_name] %>.ca
    <% end -%>
    SetEnvIf User-Agent ".*MSIE.*" nokeepalive ssl-unclean-shutdown downgrade-1.0 force-response-1.0

    Redirect permanent / https://<%= node[:deploy][@application_name][:redirect_to] %>/
  </VirtualHost>
<% end -%>